#!/bin/bash

pname="$(basename $0)"
based="$(dirname $0)"/..
stime="$(date +%Y%m%d%H%M%S)"

tmpd=/tmp/"$pname"."$stime"."$$"

mkdir -p "$tmpd"

#####################################################

echo -n $* |
tr 'A-Z' 'a-z' > "$tmpd"/stat

if [ ! -s "$tmpd"/stat ] ; then
    cat "$based"/data/wordle-answers-alphabetical.txt
    rm -rf "$tmpd"
    exit 0
fi

xargs -n10  < "$tmpd"/stat  >&2

xargs -n2  < "$tmpd"/stat   |
awk '$2==0{print $1}'   |
sort -u |
tr -d '\n'  > "$tmpd"/not-included

xargs -n2  < "$tmpd"/stat   |
awk '$2==1{print $1}'   |
sort -u |
awk '{ print "grep", $1, "|" }END{ print "cat" }' > "$tmpd"/included.sh


xargs -n10 < "$tmpd"/stat   |
awk '{
    for(i=1;i<5;i++) {
        if(1==$(2*i)) {
            file = "'"$tmpd"'/not-in."i
            print $(2*i-1)  > file
        } else if (2==$(2*i)) {
            file = "'"$tmpd"'/in."i
            print $(2*i-1)  > file
        }
    }
}'

for i in {1..5} ; do
    if [ -s "$tmpd"/in."$i" ] ; then
        echo "$(cat "$tmpd"/in."$i")"
    elif [ -s "$tmpd"/not-in."$i" ] ; then
        echo "[^$(sort -u "$tmpd"/not-in."$i"|tr -d '\n')]"
    else
        echo .
    fi
done    |
tr -d '\n'  |
awk '{ print "^"$0"$" }'    > "$tmpd"/pattern

cat "$based"/data/wordle-answers-alphabetical.txt   |
grep -E '^[^'$(cat "$tmpd"/not-included)']{5}$' |
bash "$tmpd"/included.sh    |
grep "$(tr -d '\n' < "$tmpd"/pattern)" |
cat


#####################################################
rm -rf "$tmpd"
exit 0